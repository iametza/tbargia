<html lang="">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1.0, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Cache-control" content="no-cache">
<!-- NEEDED SCRIPTS -->
<script  src="../resources/wcs/bower_components/webcomponentsjs/webcomponents.js"></script>
<script  src="../resources/libs/require.js"></script>
<script async src="/mediascape.js"></script>
<script async src="../resources/libs/utils.js"></script>
<!-- NEEDED SCRIPTS END -->
<!--<script async src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.0.0/annyang.min.js"></script>-->
<link rel="stylesheet" type="text/css" href="../resources/css/style.css"/>
<link rel="stylesheet" type="text/css" href="../resources/css/animate.css"/>

<link rel="stylesheet" href="../styles/main.css">

<!-- WEBCOMPONETS -->
<!--
<link rel="import" href="../resources/wcs/bower_components/polymer/polymer.html">
<link rel="import" href="../resources/wcs/component-query.html">
<link rel="import" href="../resources/wcs/audio-video-sm/video-audio.html">
<link rel="import" href="../resources/wcs/bar-graph/bar-graph.html">
-->
<link rel="import" href="/elements/elements.html">
<!-- WEBCOMPONETS END -->

<script type="text/javascript">
var app = {};
var baseUrl = "http://www.argia.eus/API/v1/multimedia";
var url = "http://www.argia.eus/multimedia";
document.addEventListener('adaptationToolkit-ready',function(data){
		
		 var app = document.querySelector('#app');
				
		
		// The dom-change event signifies when the template has stamped its DOM.
		document.addEventListener('applicationContext-ready', function() {
				
				//mediascape.Communication.getApplicationContext().setItem('route', app.route);
				/*
				mediascape.Communication.getApplicationContext().on('changeState',function(key,value){
						console.log('ruta aldatu da', key);
				});
				*/
				
				if (app.route === 'azala') {
						app.$.azalekoDatuak.url = baseUrl+'/azala';
						console.log('azala', baseUrl+'/azala');
						app.$.azalekoDatuak.generateRequest();
						console.log('mediascape agents', mediascape.Communication.getAgentId());
					
				}
				
				if (app.route === 'fitxa') {
						app.$.player.bideoNiceName = app.params.nice_name;
				}
		
		});
		app.handleResponseAzala = function(){
		};
		
		

        var AE = mediascape.AdaptationToolkit.Adaptation.multiDeviceAdaptation;
        AE.init('bestfit');
		var UI = mediascape.AdaptationToolkit.Adaptation.UIAdaptation;
		//UI.init(data.detail.components,UI.LAYOUTMODE.ADAPTABLE);
        UI.init(data.detail.components,UI.LAYOUTMODE.STATIC);
        mediascape.Communication.startApplicationContext();
		UI.useLayout('azala');
        var location = "http://"+window.location.host+window.location.pathname;
		mediascape.AdaptationToolkit.uiComponents.addAssociationPanel(location+"?group="+mediascape.Communication.GROUP_ID);
		
});

document.addEventListener('applicationContext-ready', function(data){
		console.log('appContext', mediascape.Communication.getApplicationContext());
		
});


</script>

</head>
<body style="margin-left:auto;margin-right:auto;width:90%">
 <!-- Definition of each webcompoent -->
<!--
  <x-media  id="video1" file="../resources/media/ETB2_new.mp4"  ismuted="true"></x-media>
  <x-media id="video2" file="../resources/media/Bildu_new.mp4"  ismuted="true"></x-media>
  <x-media id="video3"  file="../resources/media/EAJ_new.mp4"  ismuted="true"></x-media>
  <bar-graph id='graph' place='Irunea'></bar-graph>

  <!-- End of definition of webcompoents -->
<template is="dom-bind" id="app">

		<am-menu id="menua" noiz-ikusi="azala" route="[[route]]" ></am-menu>
		
    <am-player id="player" playerobj="{{playerobj}}" bideo-nice-name="{{params.nice_name}}" noiz-ikusi="fitxa" route="[[route]]"></am-player>

		<am-zerrenda id="gai-nabarmendua" base-url="[[baseUrl]]" tag="[[ajaxResponse.gai_nabarmendua.nice_name]]" title="[[ajaxResponse.gai_nabarmendua.izena]]" kop="4" nabarmendua noiz-ikusi="azala" route="[[route]]" ></am-zerrenda>
		<am-zerrenda id="azken-bideoak" base-url="[[baseUrl]]" tag="none" kop="4" orientation="vertical" title="Azken bideoak" noiz-ikusi="azala" route="[[route]]"></am-zerrenda>
		<am-karruselak id="am-karruselak" motak="[[ajaxResponse.azaleko_motak]]"></am-karruselak>
		
		<!-- fitxakoak -->

		<am-kontrolak id="am-kontrolak" kontrolatzeko="{{playerobj}}"></am-kontrolak>
		<am-zerrenda id="erlazionatutakoak" title="Erlazionatutako bideoak"></am-zerrenda>
		<am-karrusela id="karrusela-fitxa" class="am-karrusela" mota="[[params.mota_nice_name]]" ez-erakutsi="[[params.nice_name]]"></am-karrusela>
		
		<div>
		<iron-ajax
				id="azalekoDatuak"
				url=""
				method='GET'
				handle-as="json"
				on-response="handleResponseAzala"
				last-response="{{ajaxResponse}}">
		</iron-ajax>
		</div>


</template>
<script>
		
		
		
		new loadingPanel('/resources/images/mediascape_logo.png',6);
</script>
</body>

</html>
