<!--
@license
-->
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/google-youtube/google-youtube.html">
<link rel="import" href="../../bower_components/vimeo-player/vimeo-player.html">
<dom-module id="am-player">
  <style>
    :host {
      display: block;

    }
    .posterrarena {
    background-color: #000;
    width: 100%;
    }
    google-youtube, vimeo-player {
        margin-left: auto;
        margin-right: auto;
        max-width: 700px;
        text-align: center;
    }
    .sare-sozialak {
        padding-left: 5%;
        padding-top: 0.4em;
        padding-bottom: 0.4em;
        background-color: #EBEBEB;
        @apply(--layout-horizontal);
        @apply(--layout-center);
    }
     .info{
        margin-left: auto;
        margin-right: auto;
        width: 90%;
        font-size: 2.2em;
    }

    .h1{
      font-size: 2.8em;
    }
    #bideoAzalpena {
      /*font-size: 2.2em;*/
    }
    .info p{
      /*font-size: 2.2em;*/
    }
    .sare-sozialak .partekatu {
        cursor: pointer;
        margin: 8px 5px;
    }

    .sare-sozialak a {
        border: 3px solid #fb0009;
        border-radius: 10px;
        color: #fb0009;
        font-weight: bold;
        margin-right: 10px;
        padding: 4px 4px 4px 4px;
        text-decoration: none;
    }



  </style>
  <template>

        <iron-ajax
        id="elementuaAjax"
        url=""
        handle-as="json"
        last-response="{{elementuaResponse}}"
        on-response="elementuaJaso"
              >
    </iron-ajax>
    <div class="posterrarena">

      <template is="dom-if" if="[[youtubeId]]">
       <google-youtube id="bideoplayer"
                      playsupported="{{playSupported}}"
                      video-id="{{youtubeId}}"
                      height="394px"
                      width="700px"
                      >
        </google-youtube>
      </template>

      <template is="dom-if" if="[[vimeoId]]">

        <vimeo-player id="vimeoplayer"
                      videoid="{{vimeoId}}"
                      player_id="player1"
                      frameborder="0"
                      responsive
                      width="100%"
                      height="394px"
        ></vimeo-player>
      </template>

    </div>
    <div class="sare-sozialak layout horizontal">

     <iron-image on-click="shareFacebook" class="partekatu" sizing="contain" style="width:32px;height:32px;" src="http://www.argia.eus/template/responsive/images/facebook-botoia.png"></iron-image>

     <iron-image on-click="shareTwitter" class="partekatu" sizing="contain" style="width:32px;height:32px;" src="http://www.argia.eus/template/responsive/images/twitter-botoia.png"></iron-image>

      <a href$="{{ etiketa_lotura(elementuaResponse.etiketa_nagusia.nice_name) }}">
        <span class="mota">{{elementuaResponse.etiketa_nagusia.izena}}</span>
      </a>
      <template is="dom-repeat" items="{{elementuaResponse.bigarren_mailako_etiketak}}">
       <a href$="[[ etiketa_lotura(item.nice_name) ]]">
        <span class="mota">[[item.izena]]</span>
      </a>
      </template>

  </div>
  <div class="info">
    <h1>{{elementuaResponse.izenburua}}</h1>
    <div id="bideoAzalpena"></div>
    <p>Egilea(k):</p>
    <template is="dom-repeat" items="{{elementuaResponse.egileak}}">
      <a href$="{{egile_lotura(item.nice_name)}}"><empty>{{item.izena}}</empty> <empty>{{item.abizena}}</empty></a>
    </template>
  </div>

  </template>
  <script>
    (function () {

      Polymer({
        is: 'am-player',
        behaviors: [
          Polymer.IronResizableBehavior,
          TBArgia.RoutingBehavior
        ],
        properties: {
          bideoNiceName: {
            type: String,
            value: '',
            observer: '_bideoChanged'
          },
          playerobj: {
            type: Object,
            notify: true
          },
          youtubeId: {
            type: String,
            observer: '_youtubeIdChanged'
          }


        },

        _bideoChanged: function(newValue, oldValue){
          this._bideoaKargatu(newValue);

        },
        _youtubeIdChanged: function(newValue, oldValue){
          console.log('youtubeid: ' + newValue);

        },
        getid: function(){
          console.log('klik');
           console.log(this.$$('#bideoplayer'));
        },

        playvimeo: function(){
          $f(this.vimeoplayer).api('play');
        },

        ready: function() {
           this.addEventListener('google-youtube-ready', function(){
              console.log('google-youtube-ready');
              this.playerobj = this.$$('#bideoplayer');
            });

           this.addEventListener('vimeo-player-response', function(event){
            var vimeoPlayers = document.querySelectorAll('iframe');
            this.vimeoplayer = vimeoPlayers[0];
            this.playerobj = this.vimeoplayer;


            });




        },
        elementuaJaso: function(e, request){

            if (this.elementuaResponse) {
             this.$.bideoAzalpena.innerHTML = this.elementuaResponse.azalpena;
              if (this.elementuaResponse.embed[0].youtube_id !== '') {
                this.vimeoId = false;
                this.youtubeId = this.elementuaResponse.embed[0].youtube_id;


              }
              if (this.elementuaResponse.embed[0].vimeo_id !== '') {
                this.youtubeId = false;
                this.vimeoId = this.elementuaResponse.embed[0].vimeo_id;
              }


            }else{
              console.log('akatsa elementua APIa deitzean: ' + request);
            }

        },

        egile_lotura: function(nice_name){
          return 'http://www.argia.eus/argia-astekaria/egileak/' + nice_name;
        },
        etiketa_lotura: function(nice_name){
          return 'http://www.argia.eus/' + nice_name;
        },
        _bideoaKargatu: function (nice_name){
          // elementuaren detaileak jaso
          this.$.elementuaAjax.url = "http://www.argia.eus/API/v1/multimedia/elementuak/" + nice_name;
          this.$.elementuaAjax.generateRequest();
        },

        shareFacebook: function() {
          //url = window.location.href;
          url = app.url + '/erreportajeak/' + this.elementuaResponse.nice_name;
          window.open("https://www.facebook.com/share.php?u=" + url,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width=550,height=420");
        },
        shareTwitter: function() {
          //url = window.location.href;
          url = app.url + '/erreportajeak/' + this.elementuaResponse.nice_name;
          text = this.elementuaResponse.izenburua;
          window.open("https://twitter.com/intent/tweet?text="+text+"&url="+url+"&via=argia","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width=550,height=420")
        }


      });
    })();


   (function() {

    /**
    * Utility function for adding an event. Handles the inconsistencies
    * between the W3C method for adding events (addEventListener) and
    * IE's (attachEvent).
    */
   function addEvent(element, eventName, callback) {
       if (element.addEventListener) {
           element.addEventListener(eventName, callback, false);
       }
       else {
           element.attachEvent('on' + eventName, callback);
       }
   }


    function onPause(id) {
        status.text('paused');
    }

    function onFinish(id) {
        status.text('finished');
    }

    function onPlayProgress(data, id) {
        status.text(data.seconds + 's played');
    }
})();





  </script>

</dom-module>
